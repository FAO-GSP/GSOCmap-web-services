<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Map application to display the GSOCmap." />
    <meta name="author-corporate" content="FAO of the UN" />
    <meta name="copyright" content="http://www.fao.org/corp/copyright/en/" />
    <meta name="keywords" content="GSOCmap, GSP,  Map, FAO" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
    <link rel="icon" href="img/favicon.ico?v=1" />

    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="css/font/css/open-iconic-bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://openlayers.org/en/v4.6.4/css/ol.css" type="text/css" />
    <link rel="stylesheet" href="css/layout.css" type="text/css" />
    <link rel="stylesheet" href="css/gsocmap.css" type="text/css" />
    <link rel="stylesheet" href="css/popup.css" type="text/css" />

    <script src="https://openlayers.org/en/v4.6.4/build/ol.js" defer></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" defer
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" defer
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" defer
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js" defer></script>
    <script src="js/layout.js" defer></script>
    <script src="js/welcome.js" defer></script>
    <script src="js/gsocmap.js" defer></script>
    <script src="js/wps.js" defer></script>

    <title>GSOCmap</title>
  </head>

  <body>
    <header>
      <nav class="navbar navbar-expand-sm">
        <a class="navbar-brand" href="http://www.fao.org">
          <img src="img/banner-fao.png" alt="FAO" />
        </a>

        <span class="navbar-text">
          <h1 class="font-weight-bold">GLOSIS - GSOCmap V1.0</h1>
          <p>
            A country-driven approach to map the global soil organic carbon stock. See
            <a class="contributors"
             href="http://www.fao.org/global-soil-partnership/pillars-action/4-information-and-data/global-soil-organic-carbon-gsoc-map/gsocmap-contributors/en/">
              GSOCmap contributors.
            </a>
          </p>
        </span>
      </nav>
    </header>

    <div id="main-container" class="container-fluid">
      <div class="row row-offcanvas">
        <div id="sidebar">
          <div class="sidebar-content">
            <div id="crop" class="tab">
              Use Ctrl + Drag to select an area to crop and downloaded as raster.
            </div>
            <div id="stats" class="tab">
              Use Ctrl + Drag to select an area and calculate it's organic carbon stock.
            </div>
          </div>
          <div class="sidebar-controls">
            <button id="sidebar-toggle" data-toggle="offcanvas" data-target="#crop" class="btn btn-sm">
              <span class="oi oi-crop" title="Crop and download" aria-hidden="true"></span>
            </button>

            <button id="sidebar-toggle" data-toggle="offcanvas" data-target="#stats" class="btn btn-sm">
              <span class="oi oi-bar-chart" title="Statistics" aria-hidden="true"></span>
            </button>
          </div>
        </div>

        <main class="col pl-0 pr-0" id="content">
          <div id="map-container">
            <div id="map"></div>
          </div>
        </main>
      </div>
    </div>

    <footer>
      <a href="http://www.fao.org/global-soil-partnership/en/" target="_blank">
        <img src="img/logos/GSP.png" />
      </a>

      <a class="text-secondary font-weight-bold copyright" title="FAO Copyright" target="_blank" href="http://www.fao.org/contact-us/terms/en/">
        &copy; FAO, <span class="current-year">2018</span>
      </a>

      <a href="http://www.fao.org/global-soil-partnership/intergovernmental-technical-panel-soils/en/" target="_blank">
        <img src="img/logos/ITPS.png" />
      </a>

      <div id="gsoc-attribution"></div>
    </footer>

    <div id="map-legend">
      <h1>SOC Mg ha-1</h1>
      <img
        src="/geoserver/wms?request=GetLegendGraphic&version=1.3.0&format=image/png&width=20&height=20&layer=GSOC:GSOCmapV1.2.0&transparent=true"
      />
    </div>

    <div id="popup" class="ol-popup">
      <a href="#" id="popup-closer" class="ol-popup-closer"></a>
      <div id="popup-content"></div>
    </div>

    <div class="modal fade" id="welcome" tabindex="-1" role="dialog" aria-labelledby="welcome-title" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="welcome-title">
              This interactive map allows you to explore the GSOCmap
            </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>
              This map provides users with very useful information to monitor
              the soil condition, identify degraded areas, set restoration
              targets, explore SOC sequestration potentials, support the
              greenhouse gas emission reporting under the UNFCCC and make
              evidence based decisions to mitigate and adapt to a changing
              climate.
            </p>

            <div class="modal-links">
              <a class="text-secondary font-weight-bold" href="http://www.fao.org/global-soil-partnership/pillars-action/4-information-and-data/global-soil-organic-carbon-gsoc-map/en">Home</a>
              <span>&nbsp;|&nbsp;</span>
              <a class="text-secondary font-weight-bold" href="http://www.fao.org/documents/card/en/c/fb798a4c-ff06-4468-ad18-27787d1f3456">Leaflet</a>
              <span>&nbsp;|&nbsp;</span>
              <a class="text-secondary font-weight-bold" href="http://www.fao.org/global-soil-partnership/pillars-action/4-information-and-data/global-soil-organic-carbon-gsoc-map/gsocmap-contributors/en">Contributors</a>
            </div>
          </div>
          <div class="modal-footer">
            <div class="modal-copyright">
              &copy; FAO, <span class="current-year">2018</span>
            </div>

            <button type="button" class="btn" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Templates for WPS Requests -->
    <script type="text/xml" id="crop-template">
      <wps:Execute
        version="1.0.0"
        service="WPS"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.opengis.net/wps/1.0.0"
        xmlns:wfs="http://www.opengis.net/wfs"
        xmlns:wps="http://www.opengis.net/wps/1.0.0"
        xmlns:ows="http://www.opengis.net/ows/1.1"
        xmlns:gml="http://www.opengis.net/gml"
        xmlns:ogc="http://www.opengis.net/ogc"
        xmlns:wcs="http://www.opengis.net/wcs/1.1.1"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">
        <ows:Identifier>gs:CropCoverage</ows:Identifier>
        <wps:DataInputs>
          <wps:Input>
           <ows:Identifier>coverage</ows:Identifier>
            <wps:Reference mimeType="image/tiff" xlink:href="http://geoserver/wcs" method="POST">
             <wps:Body>
               <wcs:GetCoverage service="WCS" version="1.1.1">
                  <ows:Identifier>GSOC:GSOCmapV1.2.0RAW</ows:Identifier>
                 <wcs:DomainSubset>
                   <ows:BoundingBox crs="http://www.opengis.net/gml/srs/epsg.xml#4326">
                     <ows:LowerCorner>-180.0 -70.91725146799998</ows:LowerCorner>
                      <ows:UpperCorner>180.00833189299993 83.616081247</ows:UpperCorner>
                   </ows:BoundingBox>
                 </wcs:DomainSubset>
                  <wcs:Output format="image/tiff"/>
               </wcs:GetCoverage>
              </wps:Body>
           </wps:Reference>
          </wps:Input>
          <wps:Input>
           <ows:Identifier>cropShape</ows:Identifier>
            <wps:Data>
             <wps:ComplexData mimeType="text/xml; subtype=gml/3.1.1"><![CDATA[
                POLYGON((
                 {{points}}
               ))]]>
              </wps:ComplexData>
           </wps:Data>
          </wps:Input>
        </wps:DataInputs>
        <wps:ResponseForm>
          <wps:RawDataOutput mimeType="image/tiff">
            <ows:Identifier>result</ows:Identifier>
          </wps:RawDataOutput>
        </wps:ResponseForm>
      </wps:Execute>
    </script>
  </body>
</html>
